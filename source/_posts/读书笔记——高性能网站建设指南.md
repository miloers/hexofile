---
title: 读书笔记——高性能网站建设指南
date: 2017-03-04 23:55:25
tags: 读书笔记 JavaScript
---

![](http://upload-images.jianshu.io/upload_images/3230776-3d33665bf3a7deef.jpg)
图片来源于简书App
<!--more--><!--more-->
#### 前言

关于雅虎的14条军规。

主要记载学习笔记，以及对规则个人探究。

#### 绪言

##### 跟踪Web页面性能

我们首次访问网站时，缓存是空的。浏览器会解析HTML文档并下载网站需要的组件。用户需要大部分的时间来等待组件的下载，还有小部分时间解析HTML，脚本以及样式表上面。

#####  性能黄金法则
我们访问页面时，只有10%-20%的最终用户的响应时间花在下载HTML文档上，其余的时间都是在下载页面所需的所有组件上。

>这么看来，怎么减少这80%-90%的时间，是我们很重要的任务。

####  规则一：减少HTTP请求

随便打开一个门户网站，看看它们的网站都加载了多少的组件。
我记得最早的时候我写页面时，需要引入图片来做小图标，我把下载的图片都放入一个文件夹里，等用到那个时候就在需要引用的资源里引入这个图片。这样就增加了HTTP的请求。
书里对于我这种问题，提供了图片地图与雪碧图以及内联图片的解决方案。

##### 图片地图
图片地图这种使用方法我是没用过的，我看了看代码，在定义图片地图上的位置坐标时，很容易出错，而且劳动力还很大，性价比不高。

官方提供的小例子，来对比使用该方法，和没有使用的时间对比。
[图片地图demo。](http://stevesouders.com/hpws/imagemap-no.php?t=1488611564046)
我尝试了几次，在排除浏览器缓存的情况下，图片地图的响应时间还是优于没有使用的。在有缓存的情况下访问时间还是相差不多的。
我用浏览器在不同的网络环境测试了一下 3G（good）网络下，使用图片地图明显优于没有使用的。
可见在移动端，我们使用方法来解决问题还是很有必要的。

##### CSS Sprites
CSS雪碧图，这个方法大部分都还使用这种方法来解决问题。
将多个图片组合成一张图片，在页面中通过background-position来引用图片的偏移量。
我觉得种这方法使用起来还是优于图片地图的，最起码我觉得使用起来更方便。

我试了几次，和图片地图比起来，响应时间略微也是有一点优势的。
[雪碧图demo](http://stevesouders.com/hpws/sprites.php?t=1488612433846)

##### 内联图片
很多网站也在用这种方法了，我也在用，如果你不知道这种方法的话，我猜你肯定看过 src="data:imgage/gif;base64..."一长串的图片资源吧，我第一次看到时，感觉这个URL怎么这么长，然后就特意去查了一下。
我通常用这种方法和HTML5的localstorage联合起来，把不经常换的图片直接储存来客户端，下次访问时忽略加载时间。我曾经也听人说过使用这种方法在存图片时也比较方便。

我也看到书中介绍文件被缓存时有意外的收获。

[内联图片demo](http://stevesouders.com/hpws/inline-images.php?t=1488612889314)

##### 合并脚本和样式表
我们在学习工作中，经常会用到各种插件，各种样式表。
然后再页面中引入多个脚本插件，有自己写的，也有外部引入的。至少我记得我以前这样过的。
军规中阐述将这些单独的文件合并到一个文件中，可以减少HTTP请求数量并缩短最终的响应时间。
看了这个demo对比真的能感受到合并脚本和样式表的必要性。
[合并脚本和样式表demo](http://stevesouders.com/hpws/combo.php)

现在webpack这么流行，解决这种问题真是让人舒服。

##### 小结
这是军规的第一条，同时作者认为这是最重要的规则，因为遵守该规则可以同时改善首次浏览和后续浏览的网站响应时间。而首次访问页面时的响应时间决定着用户是放弃你的网站还是不停地进行回访。

#### 规则二：使用内容发布网络

##### 使用CDN（Content Delivery Network）。
CDN用于发布静态内容（图片，样式表，脚本，Flash。）
优势：缩短响应时间，缓和Web流量峰值的压力。
缺点：你的响应时间可能受到其他网站的影响。CDN服务提供商在其所有的客户之间共享Web服务器组。无法控制组件服务器所带来的特殊麻烦（修改HTTP响应头.）

书里给了2个demo就不贴地址了，demo里的CDN都是国外的，小伙伴们可以自己找免费的CDN测试一下。

但不要在本地测试（笑哭）。

（未完待续）
